# ARP-Spoofing

Arp-Spoofing - это атака типа Man-In-The-Middle, осуществляется путем подмены значений в ARP таблице хостов, позволяя прослушивать сетевой трафик. 

Также необходимо настроить пересылку фреймов на конечный хост, чтобы сетевое подключение от источника к конечному хосту не терминировалось. Для проведения атаки arp-spoofing должны быть разрешены транзитные пакеты.

## Часть 1. Демонстрация ARP-Spoofing

1.1 Разрешить IPv4 forwarding можно отредактировав файл `/etc/sysctl.conf`: 
нужно раскомментировать строку `net.ipv4.ip_forward=1`. 
![](pictures/lab3_1_1.png)

После чего применим изменения командой `sysctl -p /etc/sysctl.conf`.
![](pictures/lab3_1_1_.png)

1.2 Осмотрмся в сети для поиска целевых ip: `nmap -sn 192.168.1.0/24`.

![](pictures/lab3_1_2.png)

1.4 Начнём атаку с помощью опций для двусторонней подмены `arpspoof -i eth0 -t 192.168.1.50 -r 192.168.1.100`,

где

- 50 – адрес Win7,
- 100 – адрес Switch7,
- eth0 – сетевой интерфейс Kali22.

То же самое делаем для шлюза, иначе tcp трафик пойдет в обход Kali.
`arpspoof -i eth0 -t 192.168.1.50 -r 192.168.1.1`

![](pictures/lab3_1_3.png)

ARP таблица на Win7:
![](pictures/lab3_1_3_.png)

1.5 Сделаем эхо запрос в Windows 7 к шлюзу и с помощью Wireshark увидим трафик в Kali Linux.
![](pictures/lab3_1_4_.png)

Зайдём на сайт в Windows 7 и также увидим трафик.
![](pictures/lab3_1_4.png)


## Часть 2. Защита от ARP-Spoofing

2.1 DHCP snooping — технология, базирующаяся на функционале IP-MAC-Port binding, которая позволяет предоставлять доступ к сети только авторизованным клиентам. Включаем (т.к. DAI использует DHCP Snooping Binding Table, даже если адреса статические):
![](pictures/lab3_2_1.png)

2.2 Настраиваем ARP списки доступа для инспекции, т.к. используются статические адреса.
![](pictures/lab3_2_2.png)

2.3 Включаем ARP инспекцию.
![](pictures/lab3_2_3.png)

2.4 Устанавливаем доверенный интерфейс (где подключен роутер).  Все порты, к которому подключены конечные пользователи считаются недоверенными.
![](pictures/lab3_2_4.png)

2.5 Теперь, из-за недоверенного для ARP-инспекции порта Kali и отсутствия его в списках доступа, атака неосуществима. 
![](pictures/lab3_2_5.png)
Для Win7 всё по-прежнему работает.
![](pictures/lab3_2_5_.png)